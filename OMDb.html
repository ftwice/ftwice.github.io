<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscar Información de Película</title>
    <style>
        /* Estilos generales para el cuerpo del documento */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #1b1b1b;
            color: #fff;
        }

        /* Contenedor principal */
        .container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Estilo para el título principal */
        h1 {
            text-align: center;
            color: #fff;
            font-size: 1.5em;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        /* Estilo para el formulario */
        form {
            background: #2c2c2c;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Estilo para las etiquetas de los campos del formulario */
        label {
            margin: 10px 0 5px;
            color: #fff;
            width: 100%;
        }

        /* Estilo para los campos de entrada de texto y el botón de envío */
        .input-field {
            width: calc(100% - 20px);
            max-width: 760px;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #444;
            background-color: #333;
            color: #fff;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
        }

        /* Estilo específico para el botón de envío */
        .input-field.button {
            background: #28a745;
            border: none;
            cursor: pointer;
            transition: background 0.3s, transform 0.3s;
            margin-top: 20px;
        }

        /* Estilo para el botón de envío al pasar el cursor */
        .input-field.button:hover {
            background: #218838;
            transform: scale(1.05);
        }

        /* Estilo para el contenedor de la respuesta */
        .response {
            background: #2c2c2c;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            max-width: 800px;
            margin: 20px auto;
        }

        /* Estilo para los párrafos dentro del contenedor de la respuesta */
        .response p {
            margin: 10px 0;
        }

        /* Estilo para las imágenes dentro del contenedor de la respuesta */
        .response img {
            max-width: 100%;
            border-radius: 10px;
        }

        /* Estilo para el texto adicional en la parte superior */
        .info {
            font-size: 0.8em;
            margin-bottom: 20px;
            background: #2c2c2c;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            max-width: 800px;
            margin: 0 auto;
            color: #ccc;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="info">
            <p><strong>Campos</strong></p>
            <p>Película: Campo para ingresar el nombre de la película. Se puede buscar por el título completo o parcial de la película.</p>
            <p>Director: Campo para ingresar el nombre del director. En este caso la API de OMDb no admite búsquedas directas por director. Se debe buscar en conjunto con el nombre de la película.</p>
            <p>Año: Campo para ingresar el año de la película. Filtra las búsquedas para devolver solo las películas del año especificado.</p>
            <p><strong>Validaciones</strong></p>
            <p>Si se ingresa el nombre de la "Película", devuelve todas las películas que contengan el término ingresado en el título.</p>
            <p>Si se ingresan tanto el nombre de la "Película" como el "Año", se deben cumplir ambas condiciones para devolver resultados.</p>
            <p>No se permite la búsqueda solo por año. Si el campo de "Película" y el campo de "Director" están vacíos, se muestra un mensaje de error.</p>
            <p>No se permite la búsqueda solo por Director.</p>
            <p><strong>Manejo de Resultados</strong></p>
            <p>Si se encuentran coincidencias, se muestra una lista de las películas que cumplen con los criterios de búsqueda, incluyendo el título, el año, el tipo (por ejemplo, película o serie) y el póster de la película.</p>
            <p>Si no se encuentran coincidencias, se muestra un mensaje indicando que no se encontraron películas.</p>
        </div>

        <h1>Formulario para hacer consultas a la base de datos de OMDb</h1>
        
        <!-- Formulario para ingresar el nombre de la película -->
        <form id="pelicula-formulario">
            <label for="nombre-pelicula">Película:</label>
            <input type="text" id="nombre-pelicula" name="nombre-pelicula" class="input-field" placeholder="Nombre de la película">

            <label for="director">Director:</label>
            <input type="text" id="director" name="director" class="input-field" placeholder="Director">

            <label for="año">Año:</label>
            <input type="text" id="año" name="año" class="input-field" placeholder="Año">

            <button type="submit" class="input-field button">Búsqueda</button>
        </form>

        <!-- Div donde se mostrará la respuesta de la API -->
        <div id="respuesta" class="response"></div>
    </div>

    <script>
        document.getElementById('pelicula-formulario').addEventListener('submit', function(event) {
            event.preventDefault(); // Evitar que el formulario se envíe de manera tradicional

            const nombrePelicula = document.getElementById('nombre-pelicula').value;
            const año = document.getElementById('año').value;
            const director = document.getElementById('director').value;

            // Validación: No se permite la búsqueda solo por año
            if (!nombrePelicula && !director) {
                document.getElementById('respuesta').innerText = 'Por favor ingrese al menos una película o un director. Nota: La búsqueda por director no es admitida por la API.';
                return;
            }

            // Validación: No se permite la búsqueda solo por director
            if (!nombrePelicula && director) {
                document.getElementById('respuesta').innerText = 'No se permite la búsqueda solo por Director.';
                return;
            }

            const apiKey = '1bc64afd'; // Tu clave de API de OMDB
            let url = `https://www.omdbapi.com/?apikey=${apiKey}&type=movie`;

            if (nombrePelicula) url += `&s=${encodeURIComponent(nombrePelicula)}`;
            if (año) url += `&y=${encodeURIComponent(año)}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const respuestaDiv = document.getElementById('respuesta');
                    respuestaDiv.innerHTML = '';

                    if (data.Response === "True") {
                        const promesas = data.Search.map(pelicula => {
                            const detalleUrl = `https://www.omdbapi.com/?i=${pelicula.imdbID}&apikey=${apiKey}`;
                            return fetch(detalleUrl).then(res => res.json());
                        });

                        Promise.all(promesas).then(peliculasDetalladas => {
                            const peliculasFiltradas = peliculasDetalladas.filter(pelicula => {
                                return (!director || pelicula.Director.toLowerCase().includes(director.toLowerCase())) &&
                                       (!nombrePelicula || pelicula.Title.toLowerCase().includes(nombrePelicula.toLowerCase()));
                            });

                            if (peliculasFiltradas.length > 0) {
                                peliculasFiltradas.forEach(pelicula => {
                                    let detalles = '';

                                    if (pelicula.Director && pelicula.Director !== "N/A") detalles += `<p><strong>Director:</strong> ${pelicula.Director}</p>`;
                                    if (pelicula.Writer && pelicula.Writer !== "N/A") detalles += `<p><strong>Escritores:</strong> ${pelicula.Writer}</p>`;
                                    if (pelicula.Actors && pelicula.Actors !== "N/A") detalles += `<p><strong>Actores:</strong> ${pelicula.Actors}</p>`;
                                    if (pelicula.Genre && pelicula.Genre !== "N/A") detalles += `<p><strong>Género:</strong> ${pelicula.Genre}</p>`;
                                    if (pelicula.Language && pelicula.Language !== "N/A") detalles += `<p><strong>Idioma:</strong> ${pelicula.Language}</p>`;
                                    if (pelicula.Country && pelicula.Country !== "N/A") detalles += `<p><strong>País:</strong> ${pelicula.Country}</p>`;
                                    if (pelicula.Awards && pelicula.Awards !== "N/A") detalles += `<p><strong>Premios:</strong> ${pelicula.Awards}</p>`;
                                    if (pelicula.Plot && pelicula.Plot !== "N/A") detalles += `<p><strong>Trama:</strong> ${pelicula.Plot}</p>`;
                                    if (pelicula.Rated && pelicula.Rated !== "N/A") detalles += `<p><strong>Clasificación:</strong> ${pelicula.Rated}</p>`;
                                    if (pelicula.Runtime && pelicula.Runtime !== "N/A") detalles += `<p><strong>Duración:</strong> ${pelicula.Runtime}</p>`;

                                    let poster = pelicula.Poster !== "N/A" ? `<img src="${pelicula.Poster}" alt="Poster de ${pelicula.Title}">` : '';

                                    respuestaDiv.innerHTML += 
                                        `<div>
                                            <h3>${pelicula.Title} (${pelicula.Year})</h3>
                                            ${detalles}
                                            ${poster}
                                        </div>`;
                                });
                            } else {
                                respuestaDiv.innerText = 'No se encontraron películas para los criterios especificados.';
                            }
                        });
                    } else {
                        respuestaDiv.innerText = 'Película no encontrada.';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('respuesta').innerText = 'Hubo un error al obtener la información de la película.';
                });
        });
    </script>
</body>
</html>
